---
title: "CellPhoneDB example"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

```{r setup, cache = FALSE}
# Setup document
source(here::here("code", "setup.R"))

# Function dependencies
invisible(drake::readd(download_link))
```

Introduction {.unnumbered}
============

In this document we are going to run through the example analysis for the
CellPhoneDB tool and have a look at the output it produces.

CellPhoneDB
===========

CellPhoneDB is designed to be a command line tool so we will run the following
commands in a BASH shell. CellPhoneDB takes two input files, a table of
metadata for each cell and a counts matrix. The test dataset has 10 cells and
17198 genes.

```{r export-conda-path}
conda_env <- reticulate::conda_list()[1, 2]
conda_env <- fs::path_dir(fs::path_dir(conda_env))
Sys.setenv(conda_env = conda_env)
```

```{bash cellphonedb, echo = TRUE}
eval "$(conda shell.bash hook)"
conda activate $conda_env

cellphonedb method statistical_analysis \
    --output-path output/11-cellphonedb.Rmd \
    --threads 1 \
    data/cellphonedb/test_meta.txt \
    data/cellphonedb/test_counts.txt
```

Summary {.unnumbered}
=======

Parameters {.unnumbered}
----------

This table describes parameters used and set in this document.

```{r parameters}
params <- list(
    
)
params <- toJSON(params, pretty = TRUE)
kable(fromJSON(params))
```

Output files {.unnumbered}
------------

This table describes the output files produced by this document. Right click
and _Save Link As..._ to download the results.

```{r output}
kable(data.frame(
    File = c(
        download_link("parameters.json", OUT_DIR)
    ),
    Description = c(
        "Parameters set and used in this analysis"
    )
))
```

Session information {.unnumbered}
-------------------
